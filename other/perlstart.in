
# perlstart usage info: 
# create a script.in file with the following contents (minus leading #'s)
#      #!@BOURNE_SHELL@
#      SOME_VAR_YOUR_SCRIPT_NEEDS=@SOME_VAR_YOUR_SCRIPT_NEEDS@
#      @PERL START@     (remove the embedded space and this comment)
# be sure to place your script file in configure.in AC_OUTPUT and GASNET_FIX_EXEC
# also be sure to add targets in Makefile to copy the .pl file when builddir!=srcdir

scriptname=$0

readlink='@READLINK@'
dirname='@DIRNAME@'
basename='@BASENAME@'

# written carefully to still work if readlink is missing
if test -x "$readlink" ; then
  link=`$readlink ${scriptname}`
else
  link=`/bin/ls -al ${scriptname} | @AWK@ 'BEGIN{FS=">"}{split($2,A," ") ; print A[1]}'`
fi

# be sure to follow any symbolic links to reach the location
# where this script truly resides. 
while  test "$link" && \
       "$dirname"  ${scriptname} > /dev/null 2>&1 && \
       "$basename" ${scriptname} > /dev/null 2>&1
  do
  dir=`"$dirname" ${scriptname}`;
  newpath="$link";
  newdir=`"$dirname" ${newpath}`;
  newname=`"$basename" ${newpath}`;
  dir=`cd ${dir} >/dev/null 2>&1; cd ${newdir} >/dev/null 2>&1; pwd`;
  scriptname="${dir}/${newname}";

  if test -x "$readlink" ; then
    link=`$readlink ${scriptname}`
  else
    link=`/bin/ls -al ${scriptname} | @AWK@ 'BEGIN{FS=">"}{split($2,A," ") ; print A[1]}'`
  fi
done

exec '@PERL@' "${scriptname}.pl" "$@"

echo "${scriptname}: exec failed." >&2
exit 1
